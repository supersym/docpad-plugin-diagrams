<h1>detective</h1>
<pre><code class="lang-js"><span class="keyword">var</span> esprima = require(<span class="string">'esprima'</span>);

<span class="keyword">var</span> traverse = <span class="function"><span class="keyword">function</span> <span class="params">(node, cb)</span> {</span>
    <span class="keyword">if</span> (Array.isArray(node)) {
        node.forEach(<span class="function"><span class="keyword">function</span> <span class="params">(x)</span> {</span>
            traverse(x, cb);
        });
    }
    <span class="keyword">else</span> <span class="keyword">if</span> (node &amp;&amp; <span class="keyword">typeof</span> node === <span class="string">'object'</span>) {
        cb(node);
        
        Object.keys(node).forEach(<span class="function"><span class="keyword">function</span> <span class="params">(key)</span> {</span>
            traverse(node[key], cb);
        });
    }
};

<span class="keyword">var</span> walk = <span class="function"><span class="keyword">function</span> <span class="params">(src, cb)</span> {</span>
    <span class="keyword">var</span> ast = esprima.parse(src, { range : <span class="literal">true</span> });
    traverse(ast, cb);
};

<span class="keyword">var</span> exports = module.exports = <span class="function"><span class="keyword">function</span> <span class="params">(src, opts)</span> {</span>
    <span class="keyword">return</span> exports.find(src, opts).strings;
};

exports.find = <span class="function"><span class="keyword">function</span> <span class="params">(src, opts)</span> {</span>
    <span class="keyword">if</span> (!opts) opts = {};
    <span class="keyword">var</span> word = opts.word === <span class="literal">undefined</span> ? <span class="string">'require'</span> : opts.word;
    <span class="keyword">if</span> (<span class="keyword">typeof</span> src !== <span class="string">'string'</span>) src = String(src);
    
    <span class="function"><span class="keyword">function</span> <span class="title">isRequire</span> <span class="params">(node)</span> {</span>
        <span class="keyword">var</span> c = node.callee;
        <span class="keyword">return</span> c
            &amp;&amp; node.type === <span class="string">'CallExpression'</span>
            &amp;&amp; c.type === <span class="string">'Identifier'</span>
            &amp;&amp; c.name === word
            &amp;&amp; src.slice(c.range[<span class="number">0</span>], c.range[<span class="number">1</span>] + <span class="number">1</span>) === word
        ;
    }
    
    <span class="keyword">var</span> modules = { strings : [], expressions : [] };
    
    <span class="keyword">if</span> (src.indexOf(word) == -<span class="number">1</span>) <span class="keyword">return</span> modules;
    
    walk(src, <span class="function"><span class="keyword">function</span> <span class="params">(node)</span> {</span>
        <span class="keyword">if</span> (!isRequire(node)) <span class="keyword">return</span>;
        <span class="keyword">if</span> (node.arguments.length
        &amp;&amp; node.arguments[<span class="number">0</span>].type === <span class="string">'Literal'</span>) {
            modules.strings.push(node.arguments[<span class="number">0</span>].value);
        }
        <span class="keyword">else</span> {
            <span class="keyword">var</span> r = node.arguments[<span class="number">0</span>].range;
            <span class="keyword">var</span> s = src.slice(r[<span class="number">0</span>], r[<span class="number">1</span>] + <span class="number">1</span>);
            modules.expressions.push(s);
        }
    });
    
    <span class="keyword">return</span> modules;
};
</code></pre>